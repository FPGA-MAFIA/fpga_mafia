//------------------------------------------------------------
// Title : draw tree
// Project : big_core
//------------------------------------------------------------
// File : draw_tree.c
// Author : Amichai Ben-David
// Adviser : Amichai Ben-David
// Created : 06/2023
//------------------------------------------------------------
// Description :
// POC of using the graphic library to draw lines and circles
//------------------------------------------------------------
#include "big_core_defines.h"
#include "graphic_vga.h"

// 360 elements for sin and cos in millidegrees (Scaled by 1024)
unsigned int sin_table[360]  =  { 0   , 18  , 36  , 54  , 71  , 89  , 107 , 125 , 143 , 160 , 178 , 195 , 213 , 230 , 248 , 265 , 282 , 299 , 316 , 333 , 350 , 367 , 384 , 400 , 416 , 433 , 449 , 465 , 481 , 496 ,  
                                  512 , 527 , 543 , 558 , 573 , 587 , 602 , 616 , 630 , 644 , 658 , 672 , 685 , 698 , 711 , 724 , 737 , 749 , 761 , 773 , 784 , 796 , 807 , 818 , 828 , 839 , 849 , 859 , 868 , 878 , 
                                  887 , 896 , 904 , 912 , 920 , 928 , 935 , 943 , 949 , 956 , 962 , 968 , 974 , 979 , 984 , 989 , 994 , 998 , 1002, 1005, 1008, 1011, 1014, 1016, 1018, 1020, 1022, 1023, 1023, 1024,
                                  1024, 1024, 1023, 1023, 1022, 1020, 1018, 1016, 1014, 1011, 1008, 1005, 1002, 998 , 994 , 989 , 984 , 979 , 974 , 968 , 962 , 956 , 949 , 943 , 935 , 928 , 920 , 912 , 904 , 896 ,
                                  887 , 878 , 868 , 859 , 849 , 839 , 828 , 818 , 807 , 796 , 784 , 773 , 761 , 749 , 737 , 724 , 711 , 698 , 685 , 672 , 658 , 644 , 630 , 616 , 602 , 587 , 573 , 558 , 543 , 527 , 
                                  512 , 496 , 481 , 465 , 449 , 433 , 416 , 400 , 384 , 367 , 350 , 333 , 316 , 299 , 282 , 265 , 248 , 230 , 213 , 195 , 178 , 160 , 143 , 125 , 107 , 89  , 71  , 54  , 36  , 18  ,
                                  0   , -18 , -36 , -54 , -71 , -89 , -107,-125 ,-143 ,-160 ,-178 ,-195 ,-213 ,-230 ,-248 ,-265 ,-282 ,-299 ,-316 ,-333 ,-350 ,-367 ,-384 ,-400 ,-416 ,-433 ,-449 ,-465 ,-481 ,-496 ,
                                 -512 ,-527 ,-543 ,-558 ,-573 ,-587 ,-602 ,-616 ,-630 ,-644 ,-658 ,-672 ,-685 ,-698 ,-711 ,-724 ,-737 ,-749 ,-761 ,-773 ,-784 ,-796 ,-807 ,-818 ,-828 ,-839 ,-849 ,-859 ,-868 ,-878 ,
                                 -887 ,-896 ,-904 ,-912 ,-920 ,-928 ,-935 ,-943 ,-949 ,-956 ,-962 ,-968 ,-974 ,-979 ,-984 ,-989 ,-994 ,-998 ,-1002,-1005,-1008,-1011,-1014,-1016,-1018,-1020,-1022,-1023,-1023,-1024,
                                 -1024,-1024,-1023,-1023,-1022,-1020,-1018,-1016,-1014,-1011,-1008,-1005,-1002,-998 ,-994 ,-989 ,-984 ,-979 ,-974 ,-968 ,-962 ,-956 ,-949 ,-943 ,-935 ,-928 ,-920 ,-912 ,-904 ,-896 ,
                                 -887 ,-878 ,-868 ,-859 ,-849 ,-839 ,-828 ,-818 ,-807 ,-796 ,-784 ,-773 ,-761 ,-749 ,-737 ,-724 ,-711 ,-698 ,-685 ,-672 ,-658 ,-644 ,-630 ,-616 ,-602 ,-587 ,-573 ,-558 ,-543 ,-527 ,
                                 -512 ,-496 ,-481 ,-465 ,-449 ,-433 ,-416 ,-400 ,-384 ,-367 ,-350 ,-333 ,-316 ,-299 ,-282 ,-265 ,-248 ,-230 ,-213 ,-195 ,-178 ,-160 ,-143 ,-125 ,-107 ,-89  ,-71  ,-54  ,-36  ,-18
                                };

unsigned int cos_table[360]  =  { 1024, 1024, 1023, 1023, 1022, 1020, 1018, 1016, 1014, 1011, 1008, 1005, 1002, 998 , 994 , 989 , 984 , 979 , 974 , 968 , 962 , 956 , 949 , 943 , 935 , 928 , 920 , 912 , 904 , 896  ,
                                  887 , 878 , 868 , 859 , 849 , 839 , 828 , 818 , 807 , 796 , 784 , 773 , 761 , 749 , 737 , 724 , 711 , 698 , 685 , 672 , 658 , 644 , 630 , 616 , 602 , 587 , 573 , 558 , 543 , 527  ,
                                  512 , 496 , 481 , 465 , 449 , 433 , 416 , 400 , 384 , 367 , 350 , 333 , 316 , 299 , 282 , 265 , 248 , 230 , 213 , 195 , 178 , 160 , 143 , 125 , 107 , 89  , 71  , 54  , 36  , 18   ,
                                  0   ,-18  ,-36  ,-54  ,-71  ,-89  ,-107 ,-125 ,-143 ,-160 ,-178 ,-195 ,-213 ,-230 ,-248 ,-265 ,-282 ,-299 ,-316 ,-333 ,-350 ,-367 ,-384 ,-400 ,-416 ,-433 ,-449 ,-465 ,-481 ,-496  ,
                                 -512 ,-527 ,-543 ,-558 ,-573 ,-587 ,-602 ,-616 ,-630 ,-644 ,-658 ,-672 ,-685 ,-698 ,-711 ,-724 ,-737 ,-749 ,-761 ,-773 ,-784 ,-796 ,-807 ,-818 ,-828 ,-839 ,-849 ,-859 ,-868 ,-878  ,
                                 -887 ,-896 ,-904 ,-912 ,-920 ,-928 ,-935 ,-943 ,-949 ,-956 ,-962 ,-968 ,-974 ,-979 ,-984 ,-989 ,-994 ,-998 ,-100 ,-100 ,-100 ,-101 ,-101 ,-101 ,-101 ,-102 ,-102 ,-102 ,-102 ,-1024 ,
                                 -1024,-1024,-1023,-1023,-1022,-1020,-1018,-1016,-1014,-1011,-1008,-1005,-1002,-998 ,-994 ,-989 ,-984 ,-979 ,-974 ,-968 ,-962 ,-956 ,-949 ,-943 ,-935 ,-928 ,-920 ,-912 ,-904 ,-896  ,
                                 -887 ,-878 ,-868 ,-859 ,-849 ,-839 ,-828 ,-818 ,-807 ,-796 ,-784 ,-773 ,-761 ,-749 ,-737 ,-724 ,-711 ,-698 ,-685 ,-672 ,-658 ,-644 ,-630 ,-616 ,-602 ,-587 ,-573 ,-558 ,-543 ,-527  ,
                                 -512 ,-496 ,-481 ,-465 ,-449 ,-433 ,-416 ,-400 ,-384 ,-367 ,-350 ,-333 ,-316 ,-299 ,-282 ,-265 ,-248 ,-230 ,-213 ,-195 ,-178 ,-160 ,-143 ,-125 ,-107 ,-89  ,-71  ,-54  ,-36  ,-18   ,
                                  0   , 18  , 36  , 54  , 71  , 89  , 107 , 125 , 143 , 160 , 178 , 195 , 213 , 230 , 248 , 265 , 282 , 299 , 316 , 333 , 350 , 367 , 384 , 400 , 416 , 433 , 449 , 465 , 481 , 496  ,
                                  512 , 527 , 543 , 558 , 573 , 587 , 602 , 616 , 630 , 644 , 658 , 672 , 685 , 698 , 711 , 724 , 737 , 749 , 761 , 773 , 784 , 796 , 807 , 818 , 828 , 839 , 849 , 859 , 868 , 878  ,
                                  887 , 896 , 904 , 912 , 920 , 928 , 935 , 943 , 949 , 956 , 962 , 968 , 974 , 979 , 984 , 989 , 994 , 998 , 1002, 1005, 1008, 1011, 1014, 1016, 1018, 1020, 1022, 1023, 1023, 1024
                                };

#define MAX_ANGLE 360


void draw_fractal_tree(int x1, int y1, int angle, int length, int branch_angle, int length_ratio_A, int length_ratio_B) {
    if (length < 2) {
        return;
    }
    
    // Correct the negative angle value
    if (angle < 0) {
        angle = MAX_ANGLE + angle;
    }
    
    // Calculate x2
    int cos_value = cos_table[angle];
    int length_times_cos = length * cos_value;
    int length_times_cos_divided = length_times_cos / 1024;
    int x2 = x1 + length_times_cos_divided;

    // Calculate y2
    int sin_value = sin_table[angle];
    int length_times_sin = length * sin_value;
    int length_times_sin_divided = length_times_sin / 1024;
    int y2 = y1 - length_times_sin_divided;

    draw_line(x1, y1, x2, y2, 1);

    // Correct the new angle for the left branch
    int new_angle_left = angle - branch_angle;
    if (new_angle_left < 0) {
        new_angle_left = MAX_ANGLE + new_angle_left;
    }
    // Calculate the new length for the left branch
    int new_length_left = (length * length_ratio_A) / length_ratio_B;
    
    // Call the function for the left branch
    draw_fractal_tree(x2, y2, new_angle_left, new_length_left, branch_angle, length_ratio_A, length_ratio_B);

    // Correct the new angle for the right branch
    int new_angle_right = (angle + branch_angle) % MAX_ANGLE;
    // Calculate the new length for the right branch
    int new_length_right = length * length_ratio_A / length_ratio_B;

    // Call the function for the right branch
    draw_fractal_tree(x2, y2, new_angle_right, new_length_right, branch_angle, length_ratio_A, length_ratio_B);
}


int main() {
    //clear_screen();
    //while (1){
    int x1 = 320;            // Starting x-coordinate
    int y1 = 470;          // Starting y-coordinate
    int angle = 90;         // Starting angle (facing right)
    int length = 16 ;     // Starting length
    int branch_angle = 45; // Angle for each branch
    int length_ratio_A = 1;// Numerator of the length ratio   -> A/B
    int length_ratio_B = 2;// Denominator of the length ratio -> A/B

    draw_fractal_tree(x1, y1, angle, length, branch_angle, length_ratio_A, length_ratio_B);
    //}

    return 0;
}
